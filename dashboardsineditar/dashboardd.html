<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sistema de Administración de Usuarios</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/src/toastify.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css"> <!-- Enlace al CSS externo -->
</head>
<body class="bg-gray-100">
<div class="flex flex-col h-screen">
    <!-- Header -->
    <header class="header flex items-center px-6 shadow-md">
        <button id="sidebarToggleBtn" class="text-white text-2xl mr-4 focus:outline-none">
            <i class="fas fa-bars"></i>
        </button>
        <h1 class="text-xl font-bold text-white">Sistema de Administración de Usuarios</h1>
    </header>

    <!-- Main Content -->
    <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar text-white overflow-y-auto">
            <div class="p-4">
                <button id="createUserBtn" class="btn-primary w-full flex items-center justify-center mb-6">
                    <i class="fas fa-plus mr-2"></i> <span class="sidebar-text">Crear Usuario</span>
                </button>

                <div class="mb-4">
                    <h3 class="font-bold mb-2"><span class="sidebar-text">Filtros</span></h3>

                    <!-- Alumnos -->
                    <div class="role-container mb-2">
                        <div class="role-item flex items-center justify-between" data-role="alumnos">
                            <i class="fas fa-user-graduate mr-2"></i> <span class="sidebar-text">Alumnos</span>
                            <i class="fas fa-chevron-right chevron"></i>
                        </div>
                        <div class="sub-role" id="alumnos-sub">
                            <div class="role-item" data-subrole="vigente">
                                <i class="fas fa-check-circle mr-2"></i> <span class="sidebar-text">Vigente</span>
                            </div>
                            <div class="role-item" data-subrole="titulado">
                                <i class="fas fa-graduation-cap mr-2"></i> <span class="sidebar-text">Titulado</span>
                            </div>
                            <div class="role-item" data-subrole="egresado">
                                <i class="fas fa-user-clock mr-2"></i> <span class="sidebar-text">Egresado</span>
                            </div>
                        </div>
                    </div>

                    <!-- Funcionarios -->
                    <div class="role-container mb-2">
                        <div class="role-item flex items-center justify-between" data-role="funcionarios">
                            <i class="fas fa-user-tie mr-2"></i> <span class="sidebar-text">Funcionarios</span>
                            <i class="fas fa-chevron-right chevron"></i>
                        </div>
                        <div class="sub-role" id="funcionarios-sub">
                            <div class="role-item" data-subrole="administrativo">
                                <i class="fas fa-briefcase mr-2"></i> <span class="sidebar-text">Administrativo</span>
                            </div>
                            <div class="role-item" data-subrole="docente">
                                <i class="fas fa-chalkboard-teacher mr-2"></i> <span class="sidebar-text">Docente</span>
                            </div>
                            <div class="role-item" data-subrole="directivo">
                                <i class="fas fa-user-shield mr-2"></i> <span class="sidebar-text">Directivo</span>
                            </div>
                        </div>
                    </div>

                    <!-- Externos -->
                    <div class="role-container mb-2">
                        <div class="role-item flex items-center justify-between" data-role="externos">
                            <i class="fas fa-user-friends mr-2"></i> <span class="sidebar-text">Externos</span>
                            <i class="fas fa-chevron-right chevron"></i>
                        </div>
                        <div class="sub-role" id="externos-sub">
                            <div class="role-item" data-subrole="proveedor">
                                <i class="fas fa-truck mr-2"></i> <span class="sidebar-text">Proveedor</span>
                            </div>
                            <div class="role-item" data-subrole="invitado">
                                <i class="fas fa-handshake mr-2"></i> <span class="sidebar-text">Invitado</span>
                            </div>
                            <div class="role-item" data-subrole="convenio">
                                <i class="fas fa-file-contract mr-2"></i> <span class="sidebar-text">Convenio</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </aside>

        <!-- Main Area -->
        <main class="flex-1 p-6 overflow-y-auto">
            <div class="bg-white rounded-lg shadow-md p-6 w-full"> <!-- Added w-full here -->
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Usuarios</h2>
                    <div class="relative">
                        <input type="text" id="searchInput" placeholder="Buscar usuarios..." class="form-control pr-10">
                        <i id="searchIcon" class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 cursor-pointer"></i>
                    </div>
                </div>

                <div class="table-container">
                    <table id="usersTable">
                        <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Email</th>
                            <th>Teléfono</th>
                            <th>Departamento</th>
                            <th>Rol</th>
                            <th>Sub-Rol</th>
                            <th>Acciones</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- Table content will be dynamically populated -->
                        </tbody>
                    </table>
                </div>

                <div id="noUsersMessage" class="hidden text-center py-8 text-gray-500">
                    <i class="fas fa-users text-5xl mb-4"></i>
                    <p>No hay usuarios para mostrar</p>
                    <button id="addFirstUserBtn" class="btn-primary mt-4">
                        <i class="fas fa-plus mr-2"></i> <span class="sidebar-text">Agregar primer usuario</span>
                    </button>
                </div>
            </div>
            
            <!-- Sección SGU_USUARIO (Oracle): lista datos desde la API PHP -->
            <div class="bg-white rounded-lg shadow-md p-6 w-full mt-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">SGU_USUARIO (Oracle)</h2>
                    <div class="flex items-center space-x-3">
                        <input id="oracleLimit" type="number" min="1" max="1000" value="100" class="form-control w-24" title="Límite de filas">
                        <button id="loadOracleBtn" class="btn-primary">Cargar SGU_USUARIO</button>
                    </div>
                </div>
                <p id="oracleStatus" class="text-sm text-gray-500 mb-3"></p>

                <div class="table-container">
                    <table id="oracleTable">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div id="oracleNoData" class="hidden text-center py-8 text-gray-500">
                    <i class="fas fa-database text-5xl mb-4"></i>
                    <p>No hay datos para mostrar</p>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Create/Edit User Modal -->
<div id="userModal" class="modal">
    <div class="modal-content">
        <div class="p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-xl font-bold text-gray-800">Crear Usuario</h3>
                <button id="closeModal" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <form id="userForm">
                <input type="hidden" id="userId">

                <div class="form-group">
                    <label for="userName" class="block mb-1 font-medium">Nombre</label>
                    <input type="text" id="userName" class="form-control" required>
                    <div id="userNameError" class="error-message hidden">El nombre es requerido</div>
                </div>

                <div class="form-group">
                    <label for="userEmail" class="block mb-1 font-medium">Email</label>
                    <input type="email" id="userEmail" class="form-control" required>
                    <div id="userEmailError" class="error-message hidden">Ingrese un email válido</div>
                </div>

                <div class="form-group">
                    <label for="userPhone" class="block mb-1 font-medium">Teléfono</label>
                    <input type="tel" id="userPhone" class="form-control" required>
                    <div id="userPhoneError" class="error-message hidden">Ingrese un teléfono válido</div>
                </div>

                <div class="form-group">
                    <label for="userDepartment" class="block mb-1 font-medium">Departamento</label>
                    <input type="text" id="userDepartment" class="form-control" required>
                    <div id="userDepartmentError" class="error-message hidden">El departamento es requerido</div>
                </div>

                <div class="form-group">
                    <label for="userRole" class="block mb-1 font-medium">Rol</label>
                    <select id="userRole" class="form-control" required>
                        <option value="">Seleccione un rol</option>
                        <option value="alumnos">Alumnos</option>
                        <option value="funcionarios">Funcionarios</option>
                        <option value="externos">Externos</option>
                    </select>
                    <div id="userRoleError" class="error-message hidden">Seleccione un rol</div>
                </div>

                <div class="form-group">
                    <label for="userSubRole" class="block mb-1 font-medium">Sub-Rol</label>
                    <select id="userSubRole" class="form-control" required disabled>
                        <option value="">Seleccione un sub-rol</option>
                        <!-- Options will be populated dynamically -->
                    </select>
                    <div id="userSubRoleError" class="error-message hidden">Seleccione un sub-rol</div>
                </div>

                <div class="flex justify-end mt-6 space-x-4">
                    <button type="button" id="cancelBtn" class="btn-secondary">Cancelar</button>
                    <button type="submit" id="saveBtn" class="btn-primary">
                        <span id="saveSpinner" class="loading-spinner hidden"></span>
                        <span id="saveText">Guardar</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal">
    <div class="modal-content w-96">
        <div class="p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Confirmar Eliminación</h3>
            <p>¿Estás seguro que deseas eliminar al usuario <span id="deleteUserName" class="font-semibold"></span>?</p>
            <p class="text-sm text-gray-500 mt-2">Esta acción no se puede deshacer.</p>

            <div class="flex justify-end mt-6 space-x-4">
                <button id="cancelDeleteBtn" class="btn-secondary">Cancelar</button>
                <button id="confirmDeleteBtn" class="btn-danger">
                    <span id="deleteSpinner" class="loading-spinner hidden"></span>
                    <span id="deleteText">Eliminar</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Reset Confirmation Modal -->
<div id="resetModal" class="modal">
    <div class="modal-content w-96">
        <div class="p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Confirmar Reinicio</h3>
            <p>¿Estás seguro que deseas reiniciar todos los datos?</p>
            <p class="text-sm text-gray-500 mt-2">Esta acción eliminará todos los usuarios y no se puede deshacer.</p>

            <div class="flex justify-end mt-6 space-x-4">
                <button id="cancelResetBtn" class="btn-secondary">Cancelar</button>
                <button id="confirmResetBtn" class="btn-danger">
                    <span id="resetSpinner" class="loading-spinner hidden"></span>
                    <span id="resetText">Reiniciar</span>
                </button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script src="script.js"></script> <!-- Enlace al JavaScript externo -->
</body>
</html>
